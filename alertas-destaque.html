{% set alertas = store.featuredIcon() %}
{% if alertas|length > 0 %}
<div id="alerts">
  <div class="central owlCarousel">
    {% for alerta in alertas %}
      {% set icone = alerta.icone_tipo == '1' ?
        '<i class="fa ' ~ alerta.icone ~ '" style="color: ' ~ alerta.cor_icone ~ '"></i>' :
        '<img src="' ~ alerta.icone ~ '" alt="' ~ alerta.nome ~ '" />'
      %}
      {% if alerta.link %}
        <a class="alerts-item" href="{{ alerta.link }}" target="{{ alerta.target }}">
          {{ icone|raw }}
          <span>{{ alerta.nome|raw }}</span>
        </a>
      {% else %}
        <div class="alerts-item" style="background-color: {{ alerta.cor_fundo }}">
          {{ icone|raw }}
          <span style="color: {{ alerta.cor_texto }}">
            {{ alerta.nome|raw }}
          </span>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<script>
  $(function () {
    var $carousel = $('#alerts .owlCarousel');
    if (!$carousel.length) return;

    var MOBILE_MAX = 799; // <= 799px roda owl (mobile). 800+ NÃƒO roda.
    var isInit = false;

    function initMobileCarousel() {
      if (isInit) return;

      $carousel.owlCarousel({
        nav: true,
        dots: true,
        autoplay: true,
        loop: true,
        rewind: false,
        autoplayHoverPause: false,
        autoplayTimeout: 5 * 1000,
        touchDrag: true,
        mouseDrag: true,
        animateOut: 'bounceOutLeft',
        animateIn: 'bounceInRight',
        responsiveClass: true,
        autoHeight: true,
        navText: [
          "<i class='ri-arrow-left-wide-line'></i>",
          "<i class='ri-arrow-right-wide-line'></i>"
        ],
        items: 1,
        margin: 0,
        slideBy: 1
      });

      isInit = true;
    }

    function destroyCarousel() {
      if (!isInit) return;

      // destroy + limpa markup extra do owl
      $carousel.trigger('destroy.owl.carousel');
      $carousel.removeClass('owl-loaded owl-hidden');
      $carousel.find('.owl-stage-outer').children().unwrap();
      $carousel.find('.owl-stage').children().unwrap();
      $carousel.find('.owl-nav, .owl-dots').remove();

      isInit = false;
    }

    function applyByWidth() {
      if (window.innerWidth <= MOBILE_MAX) {
        initMobileCarousel();
      } else {
        destroyCarousel();
      }
    }

    // aplica ao carregar
    applyByWidth();

    // aplica ao redimensionar (debounce)
    var resizeTimer;
    $(window).on('resize', function () {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(applyByWidth, 150);
    });
  });
</script>
{% endif %}
